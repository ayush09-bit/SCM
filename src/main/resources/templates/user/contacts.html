<!DOCTYPE html>
<html lang="en" th:replace="~{base :: parent(~{:: #content},~{::title},~{::script})}">
  <title data-th-text="${loggedinuser.name} + ' Contacts'">Contacts</title>
<body>

  <div id="content">

    <!-- sidebar (unchanged) -->
    <div th:if="${loggedinuser}">
      <div data-th-replace="~{user/sidebar :: sidebar}"></div>
    </div>

    <!-- PAGE CONTENT -->
    <div class="sm:pl-68 pt-20 px-4 pb-12">

      <!-- Header -->
      <div class="max-w-7xl mx-auto">
        <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4 mb-6">
          <div>
            <h1 class="text-3xl font-bold text-gray-800 dark:text-gray-100">All Your Contacts</h1>
            <p class="text-sm text-gray-500 dark:text-gray-400">List of all contacts saved by you</p>
          </div>

          <!-- Search + Export -->
          <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 w-full">

  <!-- Search Form -->
  <form data-th-object="${contactSearchForm}"
        data-th-action="@{'/user/contacts/search'}"
        class="flex flex-col sm:flex-row items-stretch sm:items-center gap-3 w-full sm:w-auto">

    <select data-th-field="*{field}"
            class="h-10 w-full sm:w-28 bg-white dark:bg-gray-800 
                   border border-gray-300 dark:border-gray-700 
                   rounded-md text-sm px-3 text-gray-700 dark:text-gray-200">
      <option value="">Field</option>
      <option value="name">Name</option>
      <option value="phone">Phone</option>
      <option value="email">Email</option>
    </select>

    <input data-th-field="*{value}" type="text"
           placeholder="Search..."
           class="h-10 w-full sm:w-64 rounded-md bg-gray-50 dark:bg-gray-700 
                  border border-gray-300 dark:border-gray-600 
                  text-sm px-3 text-gray-800 dark:text-gray-100"/>

    <button type="submit"
            class="h-10 px-4 rounded-md bg-gray-800 text-white hover:bg-gray-900 
                   dark:bg-gray-600 dark:hover:bg-gray-500 w-full sm:w-auto">
      Search
    </button>
  </form>

  <!-- Message Box -->
  <div class="w-full sm:w-auto" data-th-replace="~{message :: messagebox}"></div>

  <!-- Export Button -->
  <button type="button" onclick="exportData()"
          class="h-10 px-3 rounded-md bg-green-600 text-white hover:bg-green-700 
                 w-full sm:w-auto">
    Export
  </button>
</div>

        </div>

        <!-- Summary card -->
        <div class="bg-white dark:bg-gray-800 rounded-2xl shadow p-4 flex items-center justify-between mb-6">
          <div>
            <h2 class="text-lg font-semibold text-gray-700 dark:text-gray-200">Your Contacts</h2>
            <p class="text-sm text-gray-500 dark:text-gray-400">Total Saved Contacts</p>
          </div>
          <div class="text-right">
            <div class="text-3xl font-bold text-violet-600 dark:text-violet-400" th:text="${pageContact.totalElements}">0</div>
          </div>
        </div>

        <!-- HYBRID: Table for md+ , Cards for small screens -->
        <!-- DESKTOP TABLE -->
        <div class="hidden md:block bg-white dark:bg-gray-800 rounded-2xl shadow overflow-hidden">
          <div class="overflow-x-auto">
            <table id="contact-table" class="min-w-full divide-y divide-gray-200 dark:divide-gray-700">
              <thead class="bg-gray-50 dark:bg-gray-700 sticky top-0">
                <tr>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Contact</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Phone</th>
                  <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Links</th>
                  <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 dark:text-gray-300 uppercase">Action</th>
                </tr>
              </thead>

              <tbody class="bg-white dark:bg-gray-800 divide-y divide-gray-100 dark:divide-gray-700">
                <tr data-th-each="c : ${pageContact.getContent()}"
                    data-th-object="${c}"
                    class="hover:bg-gray-50 dark:hover:bg-gray-700 transition">
                  <!-- Contact cell -->
                  <td class="px-6 py-4">
                    <div class="flex items-center space-x-4">
                      <!-- thumbnail (use contact picture if exists otherwise local default path) -->
                      <img class="h-12 w-12 rounded-full object-cover border border-gray-200 dark:border-gray-700"
                           th:src="${c.picture != null ? c.picture : '/images/images_not_found.png'}"
                           alt="contact pic" onerror="this.src='/images/images_not_found.png'"/>

                      <div>
                        <div class="font-semibold text-gray-800 dark:text-gray-100" th:text="${c.name}">Name</div>
                        <div class="text-sm text-gray-500 dark:text-gray-400" th:text="${c.email}">email</div>
                      </div>
                    </div>
                  </td>

                  <!-- Phone -->
                  <td class="px-6 py-4 text-sm text-gray-700 dark:text-gray-200">
                    <i class="fa-solid fa-phone me-2"></i>
                    <span th:text="${c.phoneNumber}">1234567890</span>
                  </td>

                  <!-- Links -->
                  <td class="px-6 py-4 text-sm">
                    <div class="flex items-center space-x-3">
                      <div th:if="${c.favourite}" class="inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">⭐ Favourite</div>

                      <a th:if="${c.website != null}" th:href="${c.website}" target="_blank"
                         class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Website</a>

                      <a th:if="${c.linkedInLink != null}" th:href="${c.linkedInLink}" target="_blank"
                         class="text-sm text-blue-700 dark:text-blue-300 hover:underline">
                        <i class="fa-brands fa-linkedin me-1"></i>LinkedIn
                      </a>
                    </div>
                  </td>

                  <!-- Actions -->
                  <td class="px-6 py-4 text-right">
                    <div class="inline-flex items-center space-x-2">
                      <button th:onclick="deleteContact([[${c.contactId}]])"
                              class="px-3 py-1 rounded-md bg-red-600 text-white hover:bg-red-700 text-sm">Delete</button>

                      <a th:href="@{'/user/contacts/view/'+*{contactId}}" class="px-3 py-1 rounded-md bg-yellow-500 text-white hover:bg-yellow-600 text-sm">Edit</a>

                      <button th:onclick="loadContactData([[${c.contactId}]])"
                              class="px-3 py-1 rounded-md bg-blue-600 text-white hover:bg-blue-700 text-sm">View</button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <!-- pagination -->
          <div class="p-4 bg-white dark:bg-gray-800">
            <nav class="flex items-center justify-center">
              <ul class="inline-flex -space-x-px">
                <li data-th-unless="${pageContact.first}">
                  <a data-th-href="@{'/user/contacts?size='+${pageSize}+'&page=' + ${pageContact.number-1}}"
                     class="px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-l-md hover:bg-gray-100 dark:hover:bg-gray-700">Previous</a>
                </li>

                <li data-th-each="index : ${#numbers.sequence(0,pageContact.totalPages-1)}">
                  <a data-th-href="@{'/user/contacts?size='+${pageSize}+'&page='+${index}}"
                     data-th-classappend="${index==pageContact.number? 'bg-blue-50 dark:bg-gray-600' : 'bg-white dark:bg-gray-800'}"
                     class="px-3 py-1 border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700">
                    <span data-th-text="${index+1}">1</span>
                  </a>
                </li>

                <li data-th-unless="${pageContact.last}">
                  <a data-th-href="@{'/user/contacts?size='+${pageSize}+'&page=' + ${pageContact.number+1}}"
                     class="px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-r-md hover:bg-gray-100 dark:hover:bg-gray-700">Next</a>
                </li>
              </ul>
            </nav>
          </div>
        </div>

        <!-- MOBILE CARDS -->
        <div class="md:hidden space-y-4">
          <div data-th-each="c : ${pageContact.getContent()}" data-th-object="${c}"
               class="bg-white dark:bg-gray-800 border border-gray-200 dark:border-gray-700 rounded-2xl p-4 shadow">
            <div class="flex items-start space-x-4">
              <img class="h-14 w-14 rounded-full object-cover border border-gray-200 dark:border-gray-700"
                   th:src="${c.picture != null ? c.picture : '/images/images_not_found.png'}"
                   alt="contact" onerror="this.src='/images/images_not_found.png'">

              <div class="flex-1">
                <div class="flex items-center justify-between">
                  <div>
                    <div class="font-semibold text-gray-800 dark:text-gray-100" th:text="${c.name}">Name</div>
                    <div class="text-sm text-gray-500 dark:text-gray-400" th:text="${c.email}">email</div>
                  </div>

                  <div class="text-sm text-gray-500 dark:text-gray-400" th:text="${c.phoneNumber}">123456</div>
                </div>

                <div class="mt-3 flex items-center space-x-2">
                  <div th:if="${c.favourite}" class="inline-flex items-center px-2 py-0.5 rounded-full text-xs bg-yellow-100 text-yellow-800 dark:bg-yellow-900 dark:text-yellow-300">⭐ Favourite</div>

                  <a th:if="${c.website != null}" th:href="${c.website}" target="_blank" class="text-sm text-blue-600 dark:text-blue-400 hover:underline">Website</a>
                  <a th:if="${c.linkedInLink != null}" th:href="${c.linkedInLink}" target="_blank" class="text-sm text-blue-700 dark:text-blue-300 hover:underline"><i class="fa-brands fa-linkedin me-1"></i>LinkedIn</a>
                </div>

                <div class="mt-4 flex items-center space-x-2">
                  <button th:onclick="deleteContact([[${c.contactId}]])" class="px-3 py-1 rounded-md bg-red-600 text-white text-sm">Delete</button>
                  <a th:href="@{'/user/contacts/view/'+*{contactId}}" class="px-3 py-1 rounded-md bg-yellow-500 text-white text-sm">Edit</a>
                  <button th:onclick="loadContactData([[${c.contactId}]])" class="px-3 py-1 rounded-md bg-blue-600 text-white text-sm">View</button>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- MOBILE PAGINATION -->
        <div class="md:hidden mt-6">
          <nav class="flex items-center justify-center">
            <ul class="inline-flex -space-x-px">
              
              <li data-th-unless="${pageContact.first}">
                <a data-th-href="@{'/user/contacts?size='+${pageSize}+'&page=' + ${pageContact.number-1}}"
                  class="px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-l-md hover:bg-gray-100 dark:hover:bg-gray-700 text-sm">
                  Previous
                </a>
              </li>

              <li data-th-each="index : ${#numbers.sequence(0,pageContact.totalPages-1)}">
                <a data-th-href="@{'/user/contacts?size='+${pageSize}+'&page='+${index}}"
                  data-th-classappend="${index==pageContact.number? 'bg-blue-50 dark:bg-gray-600' : 'bg-white dark:bg-gray-800'}"
                  class="px-3 py-1 border border-gray-300 dark:border-gray-700 hover:bg-gray-100 dark:hover:bg-gray-700 text-sm">
                  <span data-th-text="${index+1}">1</span>
                </a>
              </li>

              <li data-th-unless="${pageContact.last}">
                <a data-th-href="@{'/user/contacts?size='+${pageSize}+'&page=' + ${pageContact.number+1}}"
                  class="px-3 py-1 bg-white dark:bg-gray-800 border border-gray-300 dark:border-gray-700 rounded-r-md hover:bg-gray-100 dark:hover:bg-gray-700 text-sm">
                  Next
                </a>
              </li>

            </ul>
          </nav>
        </div>



        <!-- No results -->
        <div data-th-if="${pageContact.totalElements <= 0}" class="text-center py-12">
          <h3 class="text-xl font-semibold text-gray-700 dark:text-gray-200">No contacts found</h3>
        </div>

      </div>
    </div>

    <!-- Modals (unchanged) -->
    <div data-th-replace="~{ user/contact_modals :: contact}"></div>

  </div>

  <!-- scripts kept same -->
  <script src="https://cdn.jsdelivr.net/npm/@linways/table-to-excel@1.0.4/dist/tableToExcel.min.js"></script>
  <script data-th-src="@{'/js/contacts.js'}"></script>

  <script>
    function exportData() {
      // keep existing export behaviour, uses desktop table
      const table = document.getElementById('contact-table');
      if (table) {
        TableToExcel.convert(table, {
          name: 'contacts.xlsx',
          sheet: { name: 'Contacts' }
        });
      }
    }
  </script>

</body>
</html>
